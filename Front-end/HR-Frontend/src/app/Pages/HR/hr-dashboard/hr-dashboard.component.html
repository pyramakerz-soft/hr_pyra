<div>
  <div class="flex items-center justify-between">
    <div>
      <p class="text-[#272D37] font-semibold text-2xl md:text-3xl mb-2">Dashboard</p>
    </div>
  </div>
</div>

<div class="my-6">
  <app-dashboard-hero></app-dashboard-hero>
</div>

<section class="grid gap-4 md:grid-cols-2 xl:grid-cols-4 mb-8">
  <article
    *ngFor="let quick of quickActions"
    class="bg-white border border-[#E0E7FF]/60 rounded-xl shadow px-5 py-4 flex flex-col justify-between hover:border-[#437EF7] transition"
  >
    <div class="flex items-start space-x-3">
      <span class="text-[#437EF7] text-xl"><i [ngClass]="quick.icon"></i></span>
      <div>
        <h3 class="text-base font-semibold text-[#17253E]">{{ quick.label }}</h3>
        <p class="text-sm text-[#5F6D7E] leading-relaxed">{{ quick.description }}</p>
      </div>
    </div>
    <div class="mt-4">
      <a
        [routerLink]="quick.route"
        class="inline-flex items-center text-sm font-semibold text-[#437EF7] hover:text-[#305fc0]"
      >
        Open
        <span class="ml-2 text-xs"><i class="fi fi-rr-arrow-right"></i></span>
      </a>
    </div>
  </article>
</section>

<section *ngIf="summaryMetrics" class="grid gap-4 md:grid-cols-2 xl:grid-cols-4 mb-8">
  <article class="bg-white border border-[#E0E7FF]/60 rounded-xl shadow px-5 py-4">
    <p class="text-sm text-[#5F6D7E] uppercase tracking-wide">Open clock issues</p>
    <p class="text-2xl font-semibold text-[#17253E]">{{ summaryMetrics?.pending_issues }}</p>
  </article>
  <article class="bg-white border border-[#E0E7FF]/60 rounded-xl shadow px-5 py-4">
    <p class="text-sm text-[#5F6D7E] uppercase tracking-wide">Live shifts</p>
    <p class="text-2xl font-semibold text-[#17253E]">{{ summaryMetrics?.open_clocks }}</p>
  </article>
  <article class="bg-white border border-[#E0E7FF]/60 rounded-xl shadow px-5 py-4">
    <p class="text-sm text-[#5F6D7E] uppercase tracking-wide">Pending excuses</p>
    <p class="text-2xl font-semibold text-[#17253E]">{{ summaryMetrics?.pending_excuses }}</p>
  </article>
  <article class="bg-white border border-[#E0E7FF]/60 rounded-xl shadow px-5 py-4">
    <p class="text-sm text-[#5F6D7E] uppercase tracking-wide">Pending overtime</p>
    <p class="text-2xl font-semibold text-[#17253E]">{{ summaryMetrics?.pending_overtime }}</p>
  </article>
</section>

<section *ngIf="presenceTotals" class="bg-white border border-[#E0E7FF]/60 rounded-xl shadow px-6 py-5 mb-8">
  <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
    <div>
      <p class="text-lg font-semibold text-[#17253E]">Today&apos;s attendance pulse</p>
      <p class="text-sm text-[#5F6D7E]">Live snapshot of presence across the organisation</p>
    </div>
    <div class="text-sm text-[#5F6D7E]">
      Updated {{ presenceSnapshot?.date | date: 'mediumDate' }}
    </div>
  </div>

  <div class="grid md:grid-cols-4 gap-4 mt-5">
    <div class="space-y-1">
      <p class="text-sm text-[#5F6D7E] uppercase">Employees</p>
      <p class="text-2xl font-semibold text-[#17253E]">{{ presenceTotals?.employees }}</p>
    </div>
    <div class="space-y-1">
      <p class="text-sm text-[#5F6D7E] uppercase">Present</p>
      <p class="text-2xl font-semibold text-[#17253E]">
        {{ presenceTotals?.present }} <span class="text-sm text-[#5F6D7E]">({{ presencePercentages.present }}%)</span>
      </p>
    </div>
    <div class="space-y-1">
      <p class="text-sm text-[#5F6D7E] uppercase">Absent</p>
      <p class="text-2xl font-semibold text-[#17253E]">
        {{ presenceTotals?.absent }} <span class="text-sm text-[#5F6D7E]">({{ presencePercentages.absent }}%)</span>
      </p>
    </div>
    <div class="space-y-1">
      <p class="text-sm text-[#5F6D7E] uppercase">On leave</p>
      <p class="text-2xl font-semibold text-[#17253E]">
        {{ presenceTotals?.on_leave }} <span class="text-sm text-[#5F6D7E]">({{ presencePercentages.onLeave }}%)</span>
      </p>
    </div>
  </div>
</section>

<div class="flex justify-end">
  <div class="w-[30%] md:w-[20%] lg:w-[10%] my-5">
    <select class="p-2 border bg-[#437ff7] rounded w-full text-white" [(ngModel)]="selectedYear" (change)="onYearChange($event)">
      <option *ngFor="let year of years" [value]="year">{{ year }}</option>
    </select>
  </div>
</div>

<div class="flex flex-col lg:flex-row gap-y-6 lg:gap-x-4">
  <div class="w-full lg:w-3/4">
    <app-bar-chart [Year]="selectedYear"></app-bar-chart>
  </div>

  <div class="w-full lg:w-1/3">
    <app-donut-chart [Year]="selectedYear" (segmentSelected)="onDepartmentSegmentSelected($event)"></app-donut-chart>
  </div>
</div>

<div class="flex flex-col md:flex-row justify-center md:space-x-3 mt-6">
  <app-card-chart [Data]="Data[0]"></app-card-chart>
  <app-card-chart [Data]="Data[1]"></app-card-chart>
</div>

<section class="grid lg:grid-cols-2 gap-6 mt-8">
  <article class="bg-white border border-[#E0E7FF]/60 rounded-xl shadow px-6 py-5">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-[#17253E]">Latest notifications</h3>
      <a routerLink="/HR/HRNotifications" class="text-sm text-[#437EF7] font-semibold hover:underline">
        View all
      </a>
    </div>
    <div *ngIf="recentNotifications.length === 0" class="text-sm text-[#5F6D7E]">
      No announcements yet. Create one from the communications center.
    </div>
    <ul *ngIf="recentNotifications.length > 0" class="space-y-3">
      <li *ngFor="let notification of recentNotifications">
        <p class="text-sm font-semibold text-[#17253E]">{{ notification.title }}</p>
        <p class="text-xs text-[#5F6D7E]">
          {{ notification.type | titlecase }} • {{ notification.created_at | date: 'medium' }}
        </p>
      </li>
    </ul>
  </article>

  <article class="bg-white border border-[#E0E7FF]/60 rounded-xl shadow px-6 py-5">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-[#17253E]">Recent service actions</h3>
      <a routerLink="/HR/HRServiceActions" class="text-sm text-[#437EF7] font-semibold hover:underline">
        Review
      </a>
    </div>
    <div *ngIf="recentServiceActions.length === 0" class="text-sm text-[#5F6D7E]">
      Execute a maintenance job to keep attendance data healthy.
    </div>
    <ul *ngIf="recentServiceActions.length > 0" class="space-y-3">
      <li *ngFor="let item of recentServiceActions">
        <p class="text-sm font-semibold text-[#17253E]">{{ item.action_type | titlecase }}</p>
        <p class="text-xs text-[#5F6D7E]">
          {{ item.status | titlecase }} • {{ item.created_at | date: 'medium' }}
        </p>
      </li>
    </ul>
  </article>
</section>
