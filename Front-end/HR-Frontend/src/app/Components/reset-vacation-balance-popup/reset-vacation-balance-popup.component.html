<div class="p-6 space-y-6 bg-white rounded-lg max-w-lg w-full">
    <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-800">Reset Vacation Balance</h2>
        <button mat-dialog-close class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <form [formGroup]="resetForm" (ngSubmit)="submitForm()" class="space-y-4">

        <!--Year Selection -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Year</label>
            <input type="number" formControlName="year"
                class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-200" />
        </div>

        <!-- Target Selection -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Reset For</label>
            <div class="flex space-x-4">
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" formControlName="target_type" value="user" class="text-blue-600" />
                    <span class="text-sm text-gray-700">User</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" formControlName="target_type" value="department" class="text-blue-600" />
                    <span class="text-sm text-gray-700">Department</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" formControlName="target_type" value="sub_department" class="text-blue-600" />
                    <span class="text-sm text-gray-700">Sub Department</span>
                </label>
            </div>
        </div>

        <!-- User Selection -->
        <div *ngIf="resetForm.get('target_type')?.value === 'user' && !data?.userId" class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-1">Select User</label>
            <div class="flex items-center border rounded px-3 py-2 focus-within:ring focus-within:ring-blue-200">
                <i class="fas fa-search text-gray-400 mr-2"></i>
                <input type="text" [value]="selectedUserName" (input)="filterUsers($event)" placeholder="Search user..."
                    class="w-full outline-none border-none" />
            </div>

            <!-- User Dropdown -->
            <div *ngIf="filteredUsers.length > 0 && !resetForm.get('user_id')?.value"
                class="absolute z-10 w-full mt-1 bg-white border rounded-md shadow-lg max-h-60 overflow-y-auto">
                <div *ngFor="let user of filteredUsers" (click)="selectUser(user)"
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm">
                    {{ user.name }}
                </div>
            </div>
        </div>

        <!-- Department Selection -->
        <div *ngIf="resetForm.get('target_type')?.value === 'department'">
            <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
            <select formControlName="department_id"
                class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-200">
                <option value="" disabled selected>Select Department</option>
                <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.name }}</option>
            </select>
        </div>

        <!-- Sub Department Selection -->
        <div *ngIf="resetForm.get('target_type')?.value === 'sub_department'">
            <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
            <select (change)="onDepartmentChange($event)"
                class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-200 mb-2">
                <option value="" disabled selected>Select Department</option>
                <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.name }}</option>
            </select>

            <label class="block text-sm font-medium text-gray-700 mb-1">Sub Department</label>
            <select formControlName="sub_department_id"
                class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-200">
                <option value="" disabled selected>Select Sub Department</option>
                <option *ngFor="let sub of subDepartments" [value]="sub.id">{{ sub.name }}</option>
            </select>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="text-sm text-red-500">
            {{ errorMessage }}
        </div>

        <!-- Actions -->
        <div class="flex justify-end space-x-3 pt-4">
            <button type="button" mat-dialog-close
                class="px-4 py-2 border rounded text-gray-600 hover:bg-gray-50">Cancel</button>
            <button type="submit" [disabled]="isSubmitting"
                class="px-4 py-2 bg-[#FF7519] text-white rounded hover:bg-[#e66a17] disabled:opacity-50">
                {{ isSubmitting ? 'Resetting...' : 'Reset Balance' }}
            </button>
        </div>
    </form>
</div>